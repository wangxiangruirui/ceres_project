# Ceres Ball Trajectory Demo

该示例程序使用 OpenCV 对 `resources/video.mp4` 中的小球进行逐帧检测，并借助 Ceres Solver 拟合以下带阻力的弹道模型：

$$
\begin{cases}
\Delta t = t - t_0\\
x(t) = x_0 + \dfrac{v_{x0}}{k}\left(1 - e^{-k \Delta t}\right)\\
y(t) = y_0 + \dfrac{v_{y0} + \frac{g}{k}}{k}\left(1 - e^{-k \Delta t}\right) - \dfrac{g}{k}\Delta t
\end{cases}
$$

求解得到的参数包括 $x_0, y_0, v_{x0}, v_{y0}, g, k$（其中 $g \in [100, 1000]$ px/s$^2$，$k \in [0.01, 1]$ 1/s）。程序会输出拟合曲线图像以及叠加拟合结果的视频到 `results` 目录。

## 运行

```bash
./build/ceres_project
```

运行后会在 `results/` 目录生成以下文件：

- `trajectory_plot.png`：拟合后的小球轨迹二维图（绿色为检测点，红色为拟合曲线）。
- `video_with_fit.mp4`：在原视频上叠加检测点与拟合结果的输出视频。

程序会在终端打印拟合得到的参数以及带阻力模型方程，其中 $y_{up}$ 以屏幕向上为正；若需转换为图像像素坐标，可使用 $y_{image} = H - y_{up}$（$H$ 为帧高）。

若检测精度不足，可以调整 `src/main.cpp` 中 `detectBallCenter` 函数的参数（例如霍夫圆检测或自适应阈值的参数），以适配不同光照或小球颜色。

## 结果
- 当采用霍夫圆形检测来确定圆心，结果为：

Δt = t - t0

x(t) = 163.718259 + (253.039512 / 0.066628) * (1 - exp(-0.066628 * Δt))

y(t) = 591.678024 + ((349.187519 + 499.435454 / 0.066628) / 0.066628) * (1 - exp(-0.066628 * Δt)) - (499.435454 / 0.066628) * Δt

- 当采用阈值分割+轮廓检测确定圆心，结果为：

Δt = t - t0

x(t) = 163.858039 + (252.594590 / 0.065521) * (1 - exp(-0.065521 * Δt))

y(t) = 591.630126 + ((349.067386 + 499.303485 / 0.065521) / 0.065521) * (1 - exp(-0.065521 * Δt)) - (499.303485 / 0.065521) * Δt
- 平均残差值为0.937